<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Critical curves &amp; points &#8212; teqp 0.19.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="../_static/ntd2d.css?v=88d0a8bc" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <script src="../_static/documentation_options.js?v=6f83b549"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Examples" href="../examples/index.html" />
    <link rel="prev" title="VLLE @ constant pressure" href="VLLE-p.html" />
  
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />


  <link rel="stylesheet" href="https://pages.nist.gov/nist-header-footer/css/nist-combined.css">
  <script src="https://code.jquery.com/jquery-3.6.2.min.js" type="text/javascript" defer="defer"></script>
  <script src="https://pages.nist.gov/nist-header-footer/js/nist-header-footer.js" type="text/javascript" defer="defer"></script>


  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.interpolate</span>
<span class="kn">import</span> <span class="nn">teqp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">teqp</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;0.19.1&#39;
</pre></div></div>
</div>
<section id="Critical-curves-&amp;-points">
<h1>Critical curves &amp; points<a class="headerlink" href="#Critical-curves-&-points" title="Link to this heading">¶</a></h1>
<section id="Pure-Fluids">
<h2>Pure Fluids<a class="headerlink" href="#Pure-Fluids" title="Link to this heading">¶</a></h2>
<p>Solving for the critical point involves finding the temperature and density that make</p>
<div class="math notranslate nohighlight">
\[\left(\frac{\partial p}{\partial \rho}\right)_T = \left(\frac{\partial^2 p}{\partial \rho^2}\right)_T = 0\]</div>
<p>by 2D non-linear rootfinding. Newton steps are taken, and the analytic Jacobian is used (thanks to the ability to do derivatives with automatic differentiation). This is all handily wrapped up in the <code class="docutils literal notranslate"><span class="pre">solve_pure_critical</span></code> method which requires the user to provide guess values for temperature and density</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Values taken from http://dx.doi.org/10.6028/jres.121.011</span>
<span class="n">modelPR</span> <span class="o">=</span> <span class="n">teqp</span><span class="o">.</span><span class="n">canonical_PR</span><span class="p">([</span><span class="mf">190.564</span><span class="p">],</span> <span class="p">[</span><span class="mi">4599200</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.011</span><span class="p">])</span>

<span class="c1"># Solve for the critical point from a point close to the critical point</span>
<span class="n">T0</span> <span class="o">=</span> <span class="mf">192.0</span>
<span class="c1"># Critical compressibility factor of P-R is 0.307401308698.. (see https://doi.org/10.1021/acs.iecr.1c00847)</span>
<span class="n">rhoc</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4599200</span><span class="o">/</span><span class="p">(</span><span class="mf">8.31446261815324</span><span class="o">*</span><span class="mf">190.564</span><span class="p">))</span><span class="o">/</span><span class="mf">0.3074</span>
<span class="n">rho0</span> <span class="o">=</span> <span class="n">rhoc</span><span class="o">*</span><span class="mf">1.2345</span> <span class="c1"># Perturb to make sure we are doing something in the solver</span>
<span class="n">modelPR</span><span class="o">.</span><span class="n">solve_pure_critical</span><span class="p">(</span><span class="n">T0</span><span class="p">,</span> <span class="n">rho0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(190.564, 9442.816240022832)
</pre></div></div>
</div>
<p>If you have a mixture, but want to obtain the critical point of a pure fluid of this mixture, you can specify the index of the component in the mixture, as well as the number of componnts in the mixture with something like:</p>
<p><code class="docutils literal notranslate"><span class="pre">model.solve_pure_critical(T0,</span> <span class="pre">rho0,</span> <span class="pre">{&quot;alternative_pure_index&quot;:</span> <span class="pre">1,</span> <span class="pre">&quot;alternative_length&quot;:</span> <span class="pre">2})</span></code> so here, for the second fluid, with 0-based index of 1, in a two-component mixture</p>
</section>
<section id="Mixtures">
<h2>Mixtures<a class="headerlink" href="#Mixtures" title="Link to this heading">¶</a></h2>
<p>A pure fluid has a single vapor-liquid critical point, but mixtures are different:</p>
<ul class="simple">
<li><p>They may have multiple (or zero!) critical points for a given mixture composition</p></li>
<li><p>The critical curves may not emanate from the pure fluid endpoints</p></li>
</ul>
<p>When it comes to critical points, intuition from pure fluids is not helpful, or sometimes even counter-productive.</p>
<p>teqp has methods for working with the critical loci of binary mixtures (only binary mixtures, for now) and especially, methods for tracing the critical curves emanating from the pure fluid endpoints.</p>
<p>The tracing method in teqp is based explicitly on the isochoric thermodynamics formalism introduced by Ulrich Deiters and Sergio Quinones-Cisneros. It uses the Helmholtz energy density as the fundamental potential and all other properties are derived from it. For critical curves it is based upon the integration of sets of ordinary differential equations; the differential equations are in the form of derivatives of the molar concentrations of each component in the mixture with respect to an
integration variable. The set of ODE is then integrated.</p>
<p>Here is an example of the construction of the critical curves emanating from the pure fluid endpoints for the mixture nitrogen + ethane.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">timeit</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">teqp</span>

<span class="k">def</span> <span class="nf">get_critical_curve</span><span class="p">(</span><span class="n">ipure</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Return curve as pandas DataFrame &quot;&quot;&quot;</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Nitrogen&#39;</span><span class="p">,</span> <span class="s1">&#39;Ethane&#39;</span><span class="p">]</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">teqp</span><span class="o">.</span><span class="n">build_multifluid_model</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">teqp</span><span class="o">.</span><span class="n">get_datapath</span><span class="p">())</span>
    <span class="n">T0</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_Tcvec</span><span class="p">()[</span><span class="n">ipure</span><span class="p">]</span>
    <span class="n">rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">get_vcvec</span><span class="p">()[</span><span class="n">ipure</span><span class="p">]]</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">rho0</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="n">ipure</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">teqp</span><span class="o">.</span><span class="n">TCABOptions</span><span class="p">()</span>
    <span class="n">o</span><span class="o">.</span><span class="n">init_dt</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># step in the arclength tracing parameter</span>
    <span class="n">o</span><span class="o">.</span><span class="n">rel_err</span> <span class="o">=</span> <span class="mf">1e-8</span>
    <span class="n">o</span><span class="o">.</span><span class="n">abs_err</span> <span class="o">=</span> <span class="mf">1e-5</span>
    <span class="n">o</span><span class="o">.</span><span class="n">integration_order</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">o</span><span class="o">.</span><span class="n">calc_stability</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">o</span><span class="o">.</span><span class="n">polish</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">curveJSON</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">trace_critical_arclength_binary</span><span class="p">(</span><span class="n">T0</span><span class="p">,</span> <span class="n">rho0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">curveJSON</span><span class="p">)</span>
    <span class="n">rhotot</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rho0 / mol/m^3&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rho1 / mol/m^3&#39;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;z0 / mole frac.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rho0 / mol/m^3&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">rhotot</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">tic</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
<span class="k">for</span> <span class="n">ipure</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">get_critical_curve</span><span class="p">(</span><span class="n">ipure</span><span class="p">)</span>
    <span class="n">first_unstable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;locally stable&#39;</span><span class="p">])</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:(</span><span class="n">first_unstable</span> <span class="k">if</span> <span class="n">first_unstable</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))]</span>
    <span class="n">line</span><span class="p">,</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;T / K&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;p / Pa&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">1e6</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>

    <span class="c1"># And interpolate to smooth out the curve using the arclength</span>
    <span class="c1"># parameter (which must be monotonically increasing) as</span>
    <span class="c1"># the interpolation variable</span>
    <span class="n">tinterp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">10000</span><span class="p">)</span>
    <span class="n">Tinterp</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;T / K&#39;</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)(</span><span class="n">tinterp</span><span class="p">)</span>
    <span class="n">pinterp</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;p / Pa&#39;</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)(</span><span class="n">tinterp</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tinterp</span><span class="p">,</span> <span class="n">pinterp</span><span class="o">/</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">get_color</span><span class="p">())</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;T / K&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;p / Pa&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">1e6</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">get_color</span><span class="p">())</span>

<span class="n">elap</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span><span class="o">-</span><span class="n">tic</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;$T$ / K&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;$p$ / MPa&#39;</span><span class="p">,</span>
    <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">350</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;time: </span><span class="si">{</span><span class="n">elap</span><span class="si">:</span><span class="s1">0.1f</span><span class="si">}</span><span class="s1"> s&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;teqp: </span><span class="si">{</span><span class="n">teqp</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">7</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/algorithms_critical_curves_5_0.png" src="../_images/algorithms_critical_curves_5_0.png" />
</div>
</div>
<p>And now for something a bit more interesting: ethane + alkane critical curves</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">timeit</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">teqp</span>

<span class="k">def</span> <span class="nf">get_critical_curve</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">ipure</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Return curve as pandas DataFrame &quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">teqp</span><span class="o">.</span><span class="n">build_multifluid_model</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">teqp</span><span class="o">.</span><span class="n">get_datapath</span><span class="p">())</span>
    <span class="n">T0</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_Tcvec</span><span class="p">()[</span><span class="n">ipure</span><span class="p">]</span>
    <span class="n">rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">get_vcvec</span><span class="p">()[</span><span class="n">ipure</span><span class="p">]]</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">rho0</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="n">ipure</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">teqp</span><span class="o">.</span><span class="n">TCABOptions</span><span class="p">()</span>
<span class="c1">#     print(dir(o))</span>
    <span class="n">o</span><span class="o">.</span><span class="n">init_dt</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># step in the parameter</span>
    <span class="n">o</span><span class="o">.</span><span class="n">rel_err</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="c1"># relative error on the step</span>
    <span class="n">o</span><span class="o">.</span><span class="n">abs_err</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="c1"># absolute error on the step</span>
    <span class="n">o</span><span class="o">.</span><span class="n">max_dt</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># cap the size of the allowed step</span>
    <span class="n">o</span><span class="o">.</span><span class="n">calc_stability</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">o</span><span class="o">.</span><span class="n">polish</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">curveJSON</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">trace_critical_arclength_binary</span><span class="p">(</span><span class="n">T0</span><span class="p">,</span> <span class="n">rho0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">curveJSON</span><span class="p">)</span>
    <span class="n">rhotot</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rho0 / mol/m^3&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rho1 / mol/m^3&#39;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;z0 / mole frac.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rho0 / mol/m^3&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">rhotot</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">tic</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
<span class="n">name0</span> <span class="o">=</span> <span class="s1">&#39;ETHANE&#39;</span>
<span class="k">for</span> <span class="n">othername</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;METHANE&#39;</span><span class="p">,</span><span class="s1">&#39;PROPANE&#39;</span><span class="p">,</span><span class="s1">&#39;BUTANE&#39;</span><span class="p">,</span><span class="s1">&#39;PENTANE&#39;</span><span class="p">,</span><span class="s1">&#39;HEXANE&#39;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">ipure</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">get_critical_curve</span><span class="p">([</span><span class="n">name0</span><span class="p">,</span> <span class="n">othername</span><span class="p">],</span> <span class="n">ipure</span><span class="p">)</span>
        <span class="n">line</span><span class="p">,</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;T / K&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;p / Pa&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">1e6</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;T / K&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;p / Pa&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">1e6</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">get_color</span><span class="p">())</span>

<span class="n">elap</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span><span class="o">-</span><span class="n">tic</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;$T$ / K&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;$p$ / MPa&#39;</span><span class="p">)</span><span class="c1">#,xlim=(100, 350), ylim=(1, 1e3))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;time: </span><span class="si">{</span><span class="n">elap</span><span class="si">:</span><span class="s1">0.1f</span><span class="si">}</span><span class="s1"> s&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;teqp: </span><span class="si">{</span><span class="n">teqp</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">7</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/algorithms_critical_curves_7_0.png" src="../_images/algorithms_critical_curves_7_0.png" />
</div>
</div>
</section>
<section id="Pure-fluid-EOS-with-nonanalytic-terms">
<h2>Pure fluid EOS with nonanalytic terms<a class="headerlink" href="#Pure-fluid-EOS-with-nonanalytic-terms" title="Link to this heading">¶</a></h2>
<p>For the highest accuracy EOS for normal water and carbon dioxide, there are non-analytic terms that prevent the initialization of the critical tracing at the pure fluid critical point. Instead, one can start close to, but not <em>AT</em>, the pure fluid endpoint. After deciding on that starting composition, one solves for the critical point and then traces away from it.</p>
<p>You might need to either do tracing in two parts, one with init_c=+1 and then init_c=-1, or one tracing might be good enough.</p>
<p>Here is an example:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_critical_curve_composition</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">rhovec0</span><span class="p">,</span> <span class="n">init_c</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Trace the critical curve from a fixed point along it &quot;&quot;&quot;</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">teqp</span><span class="o">.</span><span class="n">TCABOptions</span><span class="p">()</span>
<span class="c1">#     print(dir(o))</span>
    <span class="n">o</span><span class="o">.</span><span class="n">init_dt</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># step in the parameter</span>
    <span class="n">o</span><span class="o">.</span><span class="n">rel_err</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="c1"># relative error on the step</span>
    <span class="n">o</span><span class="o">.</span><span class="n">abs_err</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="c1"># absolute error on the step</span>
    <span class="n">o</span><span class="o">.</span><span class="n">max_dt</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># cap the size of the allowed step</span>
    <span class="n">o</span><span class="o">.</span><span class="n">calc_stability</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">o</span><span class="o">.</span><span class="n">polish</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">o</span><span class="o">.</span><span class="n">init_c</span> <span class="o">=</span> <span class="n">init_c</span> <span class="c1"># You might need to swap the initial tracing direction by making this +1.0</span>
    <span class="n">curveJSON</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">trace_critical_arclength_binary</span><span class="p">(</span><span class="n">T0</span><span class="p">,</span> <span class="n">rhovec0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">curveJSON</span><span class="p">)</span>
    <span class="n">rhotot</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rho0 / mol/m^3&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rho1 / mol/m^3&#39;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;z0 / mole frac.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rho0 / mol/m^3&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">rhotot</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="c1"># Tracing with multi-fluid from an endpoint with non-analytic terms</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">teqp</span><span class="o">.</span><span class="n">build_multifluid_model</span><span class="p">([</span><span class="s2">&quot;Water&quot;</span><span class="p">,</span> <span class="s2">&quot;Methane&quot;</span><span class="p">],</span> <span class="n">teqp</span><span class="o">.</span><span class="n">get_datapath</span><span class="p">())</span>

<span class="n">x0</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="mf">1e-6</span> <span class="c1"># ever so slightly away from the pure fluid</span>
<span class="n">molefrac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">x0</span><span class="p">])</span>

<span class="c1"># Solve for the actual critical point at this mole fraction with scipy</span>
<span class="n">y0</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">get_Tcvec</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">get_vcvec</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">residual</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">get_criticality_conditions</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">molefrac</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">fsolve</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">rho0</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">rhovec0</span> <span class="o">=</span> <span class="n">rho0</span><span class="o">*</span><span class="n">molefrac</span>

<span class="c1"># Now trace from this point</span>
<span class="n">curve</span> <span class="o">=</span> <span class="n">get_critical_curve_composition</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">T0</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">rhovec0</span><span class="o">=</span><span class="n">rhovec0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">curve</span><span class="p">[</span><span class="s1">&#39;T / K&#39;</span><span class="p">],</span> <span class="n">curve</span><span class="p">[</span><span class="s1">&#39;p / Pa&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;multifluid&#39;</span><span class="p">)</span>

<span class="c1"># With GERG-2008, things are much more straightforward...</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">teqp</span><span class="o">.</span><span class="n">make_model</span><span class="p">({</span><span class="s1">&#39;kind&#39;</span><span class="p">:</span> <span class="s1">&#39;GERG2008resid&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;names&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;water&#39;</span><span class="p">,</span><span class="s1">&#39;methane&#39;</span><span class="p">]}})</span>

<span class="k">def</span> <span class="nf">get_critical_curve_simple</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">ipure</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">rho0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Trace from a pure fluid... &quot;&quot;&quot;</span>
    <span class="n">rhovec0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">rhovec0</span><span class="p">[</span><span class="n">ipure</span><span class="p">]</span> <span class="o">=</span> <span class="n">rho0</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">teqp</span><span class="o">.</span><span class="n">TCABOptions</span><span class="p">()</span>
    <span class="n">o</span><span class="o">.</span><span class="n">init_dt</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># step in the arclength tracing parameter</span>
    <span class="n">o</span><span class="o">.</span><span class="n">rel_err</span> <span class="o">=</span> <span class="mf">1e-8</span>
    <span class="n">o</span><span class="o">.</span><span class="n">abs_err</span> <span class="o">=</span> <span class="mf">1e-5</span>
    <span class="n">o</span><span class="o">.</span><span class="n">integration_order</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">o</span><span class="o">.</span><span class="n">calc_stability</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">o</span><span class="o">.</span><span class="n">polish</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">curveJSON</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">trace_critical_arclength_binary</span><span class="p">(</span><span class="n">T0</span><span class="p">,</span> <span class="n">rhovec0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">curveJSON</span><span class="p">)</span>
    <span class="n">rhotot</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rho0 / mol/m^3&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;rho1 / mol/m^3&#39;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;z0 / mole frac.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rho0 / mol/m^3&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">rhotot</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">for</span> <span class="n">ifluid</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
    <span class="n">Tci</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_Tcvec</span><span class="p">()[</span><span class="n">ifluid</span><span class="p">]</span>
    <span class="n">vci</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_vcvec</span><span class="p">()[</span><span class="n">ifluid</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">get_critical_curve_simple</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">ipure</span><span class="o">=</span><span class="n">ifluid</span><span class="p">,</span> <span class="n">T0</span><span class="o">=</span><span class="n">Tci</span><span class="p">,</span> <span class="n">rho0</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">vci</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;T / K&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;p / Pa&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;GERG-2008&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;$T$ / K&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;$p$ / MPa&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">950</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/algorithms_critical_curves_9_0.png" src="../_images/algorithms_critical_curves_9_0.png" />
</div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Critical curves &amp; points</a><ul>
<li><a class="reference internal" href="#Pure-Fluids">Pure Fluids</a></li>
<li><a class="reference internal" href="#Mixtures">Mixtures</a></li>
<li><a class="reference internal" href="#Pure-fluid-EOS-with-nonanalytic-terms">Pure fluid EOS with nonanalytic terms</a></li>
</ul>
</li>
</ul>

  </div><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Algorithms</a><ul>
      <li>Previous: <a href="VLLE-p.html" title="previous chapter">VLLE &#64; constant pressure</a></li>
      <li>Next: <a href="../examples/index.html" title="next chapter">Examples</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/algorithms/critical_curves.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

  
    <div class="footer">
      &copy;2022, Ian Bell.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../_sources/algorithms/critical_curves.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    

  <!-- Taken from https://www.filamentgroup.com/lab/html-includes/#another-demo%3A-including-another-html-file -->
  <iframe src="../_static/ntd2d_menu.html" onload="this.before((this.contentDocument.body||this.contentDocument).children[0]);this.remove()"></iframe>
  </body>
</html>